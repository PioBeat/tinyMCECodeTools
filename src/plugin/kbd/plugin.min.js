tinymce.PluginManager.add('kbd', function (editor, url) {
    console.log("kbd url:",url, editor);
    editor.addButton('kbd', {
        text: 'Shortcuts',
        id: 'kbdID',
        icon: true,
        image: url + '/keyboard-shortcut.png',
        onclick: function () {
            var args = editor.getParam("jqueryPath");
            var args2 = editor.getParam("boostrapCSS");
            var addParams = {
                jquery: args,
                boostrap: args2
            };
            console.log("kbd clicked=",url + '/dialog.html');
            editor.windowManager.open({
                title: 'Example plugin',
                url: url + '/dialog.html',
                width: "800px",
                height: "400px",
                buttons: [
                    {
                        text: 'Submit',
                        onclick: 'submit'
                    },
                    {
                        text: 'Close',
                        onclick: 'close'
                    }],
                onsubmit: function (e) {
                    console.log("submit=", e);
                    var shortcut = editor.windowManager.getParams();
                    console.log("getParams", shortcut);
                    var selectedNode = editor.selection.getNode(), source = '';
                    console.log("after submit selectedNode", selectedNode);
                    if (selectedNode.tagName === 'KBD') { //replace
                        source = selectedNode.textContent;
                        console.log("source before=", source);
                        //sanitize
//                        source = source.replace(/<br>/g, "\r\n");
                        selectedNode.textContent = shortcut.data;
                    } else { //insert new tag
                        editor.insertContent('<kbd>' + shortcut.data + "</kbd>");
                    }
                }
            },
                    addParams);
        }
    });
});
